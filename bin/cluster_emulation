#!/usr/bin/env ruby

require 'yaml'
require_relative '../lib/consensus.rb'

pids = []

config = YAML.load(
  File.read File.expand_path 'config/nodes.yml'
)['nodes']

trap(:INT) do 
  "Killing..."

  pids.each { |p| Process.kill :INT, p }
end

config.keys.each do |id|
  pids << Process.fork { Consensus::Base.new id }
  puts pids.inspect
end